{% extends 'base.html' %}
{% load i18n %}
{% block title %}Performance Prediction | Learning Management System{% endblock title %}

{% block content %}
<h1>Performance Prediction</h1>
<form id="prediction-form" method="POST">
    {% csrf_token %}
    <label for="student_id">{% trans "Select Student" %}</label>
    <select id="student_id" name="student_id" class="form-control">
        <option value="">-- Select Student --</option>
        {% for student in students %}
        <option value="{{ student.id }}">{{ student.student.username }} - {{ student.student.get_full_name }}</option>
        {% endfor %}
    </select>
    <button type="submit" class="btn btn-primary mt-3">{% trans "Predict" %}</button>
</form>

<div id="prediction-result" style="display: none; margin-top: 20px;">
    <h3>Prediction Result:</h3>
    <p id="result"></p>
    <h4>Input Data:</h4>
    <ul id="input-data"></ul>
</div>

<script>
    document.getElementById("prediction-form").addEventListener("submit", function (e) {
        e.preventDefault();
        const formData = new FormData(this);

        fetch("{% url 'performance_prediction_view' %}", {
            method: "POST",
            body: JSON.stringify(Object.fromEntries(formData)),
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": "{{ csrf_token }}",
            },
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById("result").textContent = `Prediction: ${data.prediction}`;
            const inputDataList = document.getElementById("input-data");
            inputDataList.innerHTML = ""; // Clear previous data
            for (const [key, value] of Object.entries(data.input_data)) {
                const listItem = document.createElement("li");
                listItem.textContent = `${key}: ${value}`;
                inputDataList.appendChild(listItem);
            }
            document.getElementById("prediction-result").style.display = "block";
        })
        .catch(error => console.error("Error:", error));
    });
</script>
{% endblock content %}
